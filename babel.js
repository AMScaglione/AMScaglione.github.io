maxchars = 3200;
fadetime = 800;
chars = 'abcdefghijklmnopqrstuvwxyzaeiouy,.  ';
code = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
techAdd = 'OA9FMIDCOCIUJ2VOY5N7X44PRRTTVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789AWLNYFXJQPKV6NQ4Q16A71A3DK2MCJJ5ME8UJHCQOIZJ19K1TNRRTX5SUG53YFJBADJ7J7SJVHCHGUGKOQ071SORBR53XEYGOF7446AI5HNGQACYNP0HZLSRMBQ9Q16A71A3DK662POFLF8IVPPBEJ01GJM0RNOPQ2UGWF0G8GL1QDPE6RONGBYXKFWOIU27S6EOQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUWWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABDDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDFHZLRT5RQ8A8WQSSUUWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLM8XVQ7B325BZBZHK8NQJ8ALZAXWJYFXQZJU0MPOAZAYZUG63HZ7HLH6Q6SO9GIJJI0Q4OWALVXTVQC1ZU5BC4I0PIMGFLFS8AISWEZQVZWUPW8EPS6XTAC2CYJGNL7A5PDATQQWDOFKQY3QL73OBAXS4WIYH2IAINDJ587CMKHRYEII1OOKS262RBQSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLNNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOQQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQVBZWG22Y2Q022446789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYK9BM3L7ED8XCVCIK2MUY0QQMX3PXD56UYMX0ELAIIU5QBAHNLSSKDGJ3J5USNA40EYCE5HNYF73EMKK789AABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJLLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTVVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123556789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDFFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNPPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXZZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456799ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHJJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRTTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0133456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABDDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLNOOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWYZZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456799ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHJJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRTTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0133456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABDDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLNNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVXXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123457789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFHHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPRRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ1123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789BBCDEFGHIJKLMNOPQRSTUVWXY'

helpAdd = 'PNV0JLLNNPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMN95QTWX0FGX0ZH3A925CMTFTBMYYFPN7JMQR6U9ARUEUG53YKGI036IMMG9YLXMEP11I7MYZN3B4UYCUVG64C71HPI8CQ69XRPZSLGW4XNR5LOR5WSAW32XDLE48M35NQETUBVJGKG2YJMPQT89QC1ZUCY54Y0MI3OB8QCIAISWEHGYK34NUTOZ5RUTBX43WZKBGKHV6SYQGB2T0YGZ4P3BMX3A6RD20VG30I4A26KU69NEABLNZF1QOJ4RO6SYQUEEFBBXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIKUSMD4BQTBZUGFN8E81NJ4CGFUSGBSZZFPX6J5UW7OR34SHAE8HWZLA4OO5SO8UQB2T0F1XIQUT86UPQR8FFUWDHZBNMO4OGFHUAFPNIRGJXOKUW8OC0XGTBX43YJGNL7A59TT9KWWD0WG2YJA18N7VS45JUVWXYZ0123456789ABCDFFGHIJKLMNOPRRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789AB'

$(document).ready(function(){
  $("#search").click(function(){
    var search_str = $("#search_str").val();
    if(search_str == "technical documentation"){
      title = getTitle('317' + techAdd);
      $("#hex").val(techAdd);
      $("#wall").val('3');
      $("#shelf").val('1');
      $("#volume").val('7');
      $("#page").val('373');
      $("#searchresult").html((read('3','1','7','373',techAdd)));
      $("#volumeTitle").html(("From page 373 of <i>" + title + "</i>:"));
      return;
    }else if(search_str == "help"){
      title = getTitle('138' + helpAdd);
      $("#hex").val(techAdd);
      $("#wall").val('1');
      $("#shelf").val('3');
      $("#volume").val('8');
      $("#page").val('177');
      $("#searchresult").html((read('1','3','8','177',helpAdd)));
      $("#volumeTitle").html(("From page 177 of <i>" + title + "</i>:"));
      return;
    }
    search_str = search_str.replace(/[-\/#!$%\^&\*;:{}=\-_`"~()]/g,"").toLowerCase();
    wall = '' + parseInt(Math.random()*4+1);
    shelf = '' + parseInt(Math.random()*5+1);
    volume = '' + parseInt(Math.random()*32+1);
    page = '' + parseInt(Math.random()*410+1);
    loc = wall + shelf + volume + page;

    locSeed = genRand(loc);
    //front garbage
    frontlen = parseInt(Math.random()*(maxchars-search_str.length));
    var frontgar = '';
    for (var n = 0; n < frontlen; n++){
      frontgar = chars[parseInt(Math.random()*chars.length)] + frontgar;
    }
    //back garbage
    backlen = maxchars - (search_str.length + frontgar.length);
    var backgar = '';
    for (var n = 0; n < backlen; n++){
      backgar = backgar + chars[parseInt(Math.random()*chars.length)];
    }
    pageresult = frontgar + '<b>' + search_str + '</b>' + backgar;
    search_str = frontgar + search_str + backgar;
    console.log(search_str.length)
    //generate hexaddress, swapping values out from chars to code
    hexAdd = '';
    for(var n = 0; n < maxchars; n++){
      hexchar = code[Math.floor((chars.indexOf(search_str[n])+n+locSeed) % chars.length)];
      hexAdd += hexchar;
    }
    //generate volume title
    titleSeed = hexAdd + wall + shelf + volume;
    title = getTitle(titleSeed);
    //modify values on page to display search result
    $("#hex").val(hexAdd);
    $("#wall").val(wall);
    $("#shelf").val(shelf);
    $("#volume").val(volume);
    $("#page").val(page);
    $('#searchresult').fadeOut(fadetime, function() {
        $("#pagetext").css({"opacity": "1"})
        $(this).html((pageresult)).fadeIn(fadetime);
    });
    $('#volumeTitle').fadeOut(fadetime, function() {
        $(this).html(("From page " + page + " of <i>" + title + "</i>")).fadeIn(fadetime);
        fadetime = 100;
    });
    $("#searchtools").css({"top": "22%"});
    $("#searchresult").css({"opacity": "1"});

  });

  $("#read").click(function(){
    wall = ''+$("#wall").val();
    shelf = ''+$("#shelf").val();
    volume = ''+$("#volume").val();
    page = ''+$("#page").val();
    hexAdd = '' + $("#hex").val();
    titleSeed = hexAdd + wall + shelf + volume;
    title = getTitle(titleSeed);
    $('#searchresult').fadeOut(fadetime, function() {
        $("#pagetext").css({"opacity": "1"})
        $(this).html((read(wall, shelf, volume, page, hexAdd))).fadeIn(fadetime);
    });
    $('#volumeTitle').fadeOut(fadetime, function() {
        $(this).html(("From page " + page + " of <i>" + title + "</i>")).fadeIn(fadetime);
        fadetime = 100;
    });
    $("#searchtools").css({"top": "22%"});
  });

  $("#move").click(function(){
    $("#landingpage").css({"top": "-100%"});
  });
});

//generates deterministic "random" multiplier number based on
//location code
//implementation of Java's hashCode() function
//(credit to stackoverflow for this one)
//plus this //http://www.honeylocust.com/javascript/randomizer.html

function read(wall, shelf, volume, page, hexAdd){
    loc = wall + shelf + volume + page;
    titleSeed = hexAdd + wall + shelf + volume;
    title = getTitle(titleSeed);
    locSeed = genRand(loc);
    pageResult = '';
    //console.log(Math.floor(mod((code.indexOf(hexAdd[2])-locSeed), chars.length)));
    for(var n = 0; n < hexAdd.length; n++){
      pageResult += chars[Math.floor(mod((code.indexOf(hexAdd[n])-n-locSeed)+1, chars.length))];
    }
    //if the hex address is too short, tack on some deterministic characters
    while(pageResult.length < maxchars){
      pageResult += chars[Math.floor(genRand(pageResult))%chars.length];;
    }
    return pageResult
}

function genRand(str){
    var num = 0;
    for (var i = 0; i < str.length; i++) {
        var character = str.charCodeAt(i);
        num = ((num<<5)-num)+character;
        num = num & num; // Convert to 32bit integer
    }
    num = Math.abs(num);
    num = (num*9301+49297) % 233280;
    num = (num/(233280.0))*chars.length;
    return num;
}

//generates the title of the volume based on the address
function getTitle(input){
    //pad short hex addresses
    while(input.length < 25){
      input += code[Math.floor(genRand(input))%chars.length];;
    }
    var titleSeed = genRand(input);
    var title = '';
    //generate characters
    for(var n = 0; n < 25; n++){
      title += chars[Math.floor(mod((code.indexOf(input[n])-n-titleSeed)+1, chars.length))];
    }
    return title;
}

//https://stackoverflow.com/questions/4467539/javascript-modulo-gives-a-negative-result-for-negative-numbers
function mod(num, mod) {
    return ((num%mod)+mod)%mod;
};

function format_str(input) {
  var result = '';
  while (input.length > 0) {
    result += input.substring(0, 80) + '\n';
    input = input.substring(80);
  }
  return result;
}

$(function(){
  wall = $('#wall');
  for (var x = 1; x < 5; x++){
    wall.append($("<option ></option>").attr("value",x).text(x));
  }
  shelf = $('#shelf');
  for (var x = 1; x < 6; x++){
    shelf.append($("<option></option>").attr("value",x).text(x));
  }
  volume = $('#volume');
  for (var x = 1; x < 33; x++){
    volume.append($("<option></option>").attr("value",x).text(x));
  }
  page = $('#page');
  for (var x = 1; x < 411; x++){
    page.append($("<option></option>").attr("value",x).text(x));
  }
});
